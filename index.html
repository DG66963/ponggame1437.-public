<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ping Pong â€” mit MenÃ¼</title>
<style>
  :root{--bg:#0b1220;--panel:#0f1724;--accent:#10b981;--accent2:#60a5fa;--text:#e6eef8}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
  body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071029,#07121a);color:var(--text)}
  .wrap{width:960px;max-width:96vw;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 10px 40px rgba(2,6,23,0.7)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
  h1{font-size:18px;margin:0}
  #gameCanvas{display:block;width:100%;height:520px;border-radius:8px;background:linear-gradient(180deg,#041627,#02101a)}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:var(--panel);border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer;transition:background .2s}
  button:hover{background:rgba(255,255,255,0.05)}
  .footer{margin-top:8px;font-size:13px;color:rgba(230,238,248,0.85)}
  .menu{position:absolute;inset:0;background:rgba(2,6,23,0.9);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;text-align:center}
  .menu select, .menu button{padding:8px 12px;border-radius:8px;border:none}
  .menu h2{margin:0 0 10px 0}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Ping Pong â€” 2 Spieler / KI</h1>
      <div class="controls">
        <div class="info">Links: <span class="kbd">W / S</span> Â· Rechts: <span class="kbd">â†‘ / â†“</span></div>
        <button id="restartBtn">Neustarten</button>
        <button id="swapBtn">Seiten tauschen</button>
      </div>
    </header>

    <div id="menu" class="menu">
      <div>
        <h2>ðŸŽ® SpielmenÃ¼</h2>
        <label>Modus:
          <select id="modeSelect">
            <option value="2p">2 Spieler</option>
            <option value="ai">Gegen KI</option>
          </select>
        </label>
      </div>
      <div>
        <label>Schwierigkeit:
          <select id="diffSelect">
            <option value="easy">Leicht</option>
            <option value="medium" selected>Mittel</option>
            <option value="hard">Schwer</option>
          </select>
        </label>
      </div>
      <div id="aiDiffBox" style="display:none;">
        <label>KI-Stufe:
          <select id="aiSelect">
            <option value="easy">Dumm</option>
            <option value="medium" selected>Normal</option>
            <option value="hard">Profi</option>
          </select>
        </label>
      </div>
      <button id="startBtn">Spiel starten</button>
    </div>

    <canvas id="gameCanvas" width="960" height="520"></canvas>
    <div class="footer">Punkte bis Sieg: <span id="target">7</span> Â· Taste <span class="kbd">P</span> pausiert.</div>
  </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const restartBtn = document.getElementById('restartBtn');
const swapBtn = document.getElementById('swapBtn');
const targetEl = document.getElementById('target');
const menu = document.getElementById('menu');
const startBtn = document.getElementById('startBtn');
const modeSelect = document.getElementById('modeSelect');
const diffSelect = document.getElementById('diffSelect');
const aiSelect = document.getElementById('aiSelect');
const aiDiffBox = document.getElementById('aiDiffBox');

modeSelect.addEventListener('change', () => {
  aiDiffBox.style.display = modeSelect.value === 'ai' ? 'block' : 'none';
});

let DPR = window.devicePixelRatio || 1;
function resize(){ DPR = window.devicePixelRatio || 1; const w = canvas.clientWidth; const h = canvas.clientHeight; canvas.width = Math.floor(w * DPR); canvas.height = Math.floor(h * DPR); ctx.setTransform(DPR,0,0,DPR,0,0); }
window.addEventListener('resize', resize); resize();

// Audio helper
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = AudioCtx ? new AudioCtx() : null;
function beep(freq=440, time=0.06, type='sine', gain=0.12){
  if(!audioCtx) return; const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq; g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + time);
}

// Game state
const state = {running:false, paused:false, targetScore:7, leftScore:0, rightScore:0, lastTime:performance.now(), swapped:false, mode:"2p", aiLevel:"medium", diff:"medium"};
audioAllowed=false;
canvas.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state==='suspended'){ audioCtx.resume(); } audioAllowed=true; });

// Objects
const paddle = (x)=>({x, y:0, w:12, h:110, speed:100000, vy:0});
let left, right;
const ball = {x:0,y:0,r:9,vx:0,vy:0,speed:480,spin:0};

function resetObjects(){
  const cw = canvas.clientWidth; const ch = canvas.clientHeight;
  left = paddle(30); right = paddle(cw - 30 - 12);
  left.y = ch/2 - left.h/2; right.y = ch/2 - right.h/2;
  ball.x = cw/2; ball.y = ch/2; const angle = (Math.random()*Math.PI/4) - Math.PI/8;
  const dir = Math.random() < 0.5 ? -1 : 1;
  ball.vx = dir * ball.speed * Math.cos(angle);
  ball.vy = ball.speed * Math.sin(angle);
}

function applyDifficulty(){
  if(state.diff==="easy") ball.speed=400;
  else if(state.diff==="medium") ball.speed=480;
  else ball.speed=580;
  if(state.mode==="ai"){
    if(state.aiLevel==="easy") right.speed=250;
    else if(state.aiLevel==="medium") right.speed=400;
    else right.speed=600;
  }
}

function update(dt){
  if(state.paused||!state.running) return;
  const ch = canvas.clientHeight;
  // left player
  if(keys.w) left.vy=-left.speed; else if(keys.s) left.vy=left.speed; else left.vy=0;
  left.y += left.vy*dt; left.y = clamp(left.y,0,ch-left.h);
  // right player / AI
  if(state.mode==="2p"){
    if(keys.up) right.vy=-right.speed; else if(keys.down) right.vy=right.speed; else right.vy=0;
    right.y += right.vy*dt; right.y = clamp(right.y,0,ch-right.h);
