<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ping Pong â€“ FlÃ¼ssig & KI</title>
<style>
body {
  margin:0;
  background:linear-gradient(180deg,#0b1220,#040a14);
  color:#fff;
  font-family:sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#menu, #gameWrap {display:none;}
canvas {
  background:#0f1724;
  border:2px solid #60a5fa;
  border-radius:10px;
  display:block;
  margin:auto;
}
button, select {
  padding:8px 12px;
  border-radius:6px;
  border:none;
  cursor:pointer;
  background:#10b981;
  color:white;
  font-weight:bold;
}
button:hover {background:#0ea374;}
.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
input {
  padding:10px;
  border-radius:6px;
  border:none;
  text-align:center;
  font-size:16px;
}
#err {color:#f87171; margin-top:10px; display:none;}
.highscore {color:#facc15; margin-top:10px;}
</style>
</head>
<body>

<!-- Zugangscode -->
<div id="codeScreen" class="overlay">
  <h2>ðŸ”’ Zugangscode erforderlich</h2>
  <input id="codeInput" type="password" placeholder="Code eingeben">
  <button id="codeBtn">BestÃ¤tigen</button>
  <p id="err">Falscher Code!</p>
</div>

<!-- MenÃ¼ -->
<div id="menu" class="overlay">
  <h2>ðŸŽ® SpielmenÃ¼</h2>
  <label>Modus:
    <select id="modeSelect">
      <option value="2p">2 Spieler</option>
      <option value="ai">Gegen KI</option>
    </select>
  </label><br><br>
  <div id="aiBox" style="display:none;">
    <label>KI-Stufe:
      <select id="aiSelect">
        <option value="easy">Leicht</option>
        <option value="medium" selected>Mittel</option>
        <option value="hard">Schwer</option>
      </select>
    </label>
    <p class="highscore" id="highscoreText">Highscore: 0</p>
  </div>
  <br>
  <button id="startBtn">Spiel starten</button>
</div>

<!-- Spiel -->
<div id="gameWrap">
  <canvas id="game" width="900" height="500"></canvas>
  <div style="text-align:center; margin-top:10px;">
    <button id="restartBtn">Neustarten</button>
  </div>
</div>

<script>
// --- CodeprÃ¼fung ---
const codeScreen=document.getElementById("codeScreen");
const menu=document.getElementById("menu");
const gameWrap=document.getElementById("gameWrap");
const err=document.getElementById("err");
document.getElementById("codeBtn").onclick=()=>{
  if(document.getElementById("codeInput").value==="DG66963"){
    codeScreen.style.display="none";
    menu.style.display="flex";
    updateHighscore();
  } else err.style.display="block";
};

// --- MenÃ¼ & Highscore ---
const modeSelect=document.getElementById("modeSelect");
const aiBox=document.getElementById("aiBox");
const aiSelect=document.getElementById("aiSelect");
const highscoreText=document.getElementById("highscoreText");

modeSelect.onchange=()=>{
  aiBox.style.display = modeSelect.value==="ai"?"block":"none";
  updateHighscore();
};
aiSelect.onchange=updateHighscore;

function updateHighscore(){
  const key="pongHS_"+aiSelect.value;
  const hs=localStorage.getItem(key)||0;
  highscoreText.textContent="Highscore: "+hs;
}

// --- SPIEL ---
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
let leftY=210, rightY=210, ballX=450, ballY=250, vx=5, vy=3;
let leftScore=0, rightScore=0, ai=false, aiLevel="medium", gameRunning=false;

// Tastenstatus fÃ¼r flÃ¼ssige Bewegung
let keys = {w:false,s:false,up:false,down:false};
window.addEventListener("keydown", e=>{
  if(e.key==="w") keys.w=true;
  if(e.key==="s") keys.s=true;
  if(e.key==="ArrowUp") keys.up=true;
  if(e.key==="ArrowDown") keys.down=true;
});
window.addEventListener("keyup", e=>{
  if(e.key==="w") keys.w=false;
  if(e.key==="s") keys.s=false;
  if(e.key==="ArrowUp") keys.up=false;
  if(e.key==="ArrowDown") keys.down=false;
});

// clamp Funktion
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

// Paddle-Bewegung
function updatePaddles(){
  const speed = 5; // Geschwindigkeit pro Frame
  leftY = clamp(leftY + (keys.s?speed:0) - (keys.w?speed:0), 0, canvas.height-80);
  if(!ai) rightY = clamp(rightY + (keys.down?speed:0) - (keys.up?speed:0), 0, canvas.height-80);
}

// --- Verbesserte KI mit Vorhersage ---
function updateAI(){
  if (!ai) return;

  const paddleCenter = rightY + 40;
  const errorFactor = aiLevel === "easy" ? 40 : aiLevel === "medium" ? 20 : 8;
  const speed = aiLevel === "easy" ? 3 : aiLevel === "medium" ? 5 : 7;

  if (vx > 0) {
    // Vorhersage: Wo trifft der Ball die KI-Seite?
    const framesToImpact = (canvas.width - 880 - ballX) / vx;
    let predictedY = ballY + vy * framesToImpact;

    // Reflektiere Ball, falls er an WÃ¤nden abprallt
    while (predictedY < 0 || predictedY > canvas.height) {
      if (predictedY < 0) predictedY = -predictedY;
      if (predictedY > canvas.height) predictedY = 2 * canvas.height - predictedY;
    }

    // Fehler einbauen
    predictedY += Math.random() * errorFactor * 2 - errorFactor;

    // Paddle Richtung Ziel bewegen
    if (paddleCenter < predictedY - 10) rightY += speed;
    else if (paddleCenter > predictedY + 10) rightY -= speed;

  } else {
    // Wenn Ball wegfliegt, zentriere langsam
    const mid = canvas.height / 2 - 40;
    if (rightY < mid) rightY += 2;
    if (rightY > mid) rightY -= 2;
  }

  rightY = clamp(rightY, 0, canvas.height - 80);
}

// --- Spiel Loop ---
function draw(){
  if(!gameRunning) return;
  updatePaddles();
  updateAI();

  ctx.clearRect(0,0,900,500);
  ctx.fillStyle="#fff";
  ctx.fillRect(10,leftY,10,80);
  ctx.fillRect(880,rightY,10,80);
  ctx.beginPath();
  ctx.arc(ballX,ballY,10,0,Math.PI*2);
  ctx.fill();

  ctx.font="20px sans-serif";
  ctx.fillText(leftScore,400,30);
  ctx.fillText(rightScore,480,30);

  // Ball bewegen
  ballX+=vx; 
  ballY+=vy;

  // KollisionsprÃ¼fung oben/unten
  if(ballY<0 || ballY>500) vy*=-1;

  // Paddle-Kollision
  if(ballX<20 && ballY>leftY && ballY<leftY+80) vx*=-1;
  if(ballX>870 && ballY>rightY && ballY<rightY+80) vx*=-1;

  // Punkte
  if(ballX<0){ rightScore++; resetBall(); }
  if(ballX>900){ leftScore++; resetBall(); }

  requestAnimationFrame(draw);
}

// Ball zurÃ¼cksetzen & Gewinn prÃ¼fen
function resetBall(){
  ballX=450; ballY=250; vx*=-1;
  checkWin();
}

function checkWin(){
  if(leftScore>=7 || rightScore>=7){
    gameRunning=false;
    if(ai && leftScore>rightScore){
      const key="pongHS_"+aiLevel;
      const old=localStorage.getItem(key)||0;
      if(leftScore>old) localStorage.setItem(key,leftScore);
    }
    alert(leftScore>rightScore?"Links gewinnt!":"Rechts gewinnt!");
    updateHighscore();
    menu.style.display="flex";
    gameWrap.style.display="none";
  }
}

// Neustart
document.getElementById("restartBtn").onclick=()=>{
  leftScore=rightScore=0;
  ballX=450; ballY=250; vx=5; vy=3;
  gameRunning=true;
  draw();
};

// Start-Button
document.getElementById("startBtn").onclick=()=>{
  ai = (modeSelect.value==="ai");
  aiLevel = aiSelect.value;
  leftScore=rightScore=0;
  ballX=450; ballY=250; vx=5; vy=3;
  menu.style.display="none";
  gameWrap.style.display="block";
  gameRunning=true;
  draw();
};
</script>

</body>
</html>
